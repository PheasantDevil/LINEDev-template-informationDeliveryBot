# 今後の実装構想

## 📋 背景

現在の情報配信は、ブログへの直接アプローチからSNS（X/Twitter等）やメールを経由してブログへ遷移させるアプローチが主流となっている。本サービスは「情報や情報サイトの配信内容の概要を定期配信するLINEグループ」という独自のアプローチを提供する。

## 🎯 目標

LINE Developersへの依存を最低限にし、各チャンネルを個別に管理できる管理画面システムを構築する。

---

## 🏗️ 管理画面システムの構想

### アーキテクチャ概要

```
統合管理画面
  ├── チャンネル管理画面（各チャンネルごと）
  ├── 新規チャンネル作成承認画面
  ├── チャンネル生成・配信ログ管理画面
  └── キーワード（カテゴリ）管理画面
```

---

## 📱 機能要件

### 1. ユーザー管理機能

**機能名**: ユーザーの情報配信チャンネルへの参加/承認/否認

**目的**: 各チャンネルの管理者が、参加申請を承認または否認できる

**実装内容**:
- ユーザーがチャンネルへの参加申請を送信
- チャンネル管理者が申請を確認
- 承認/否認の選択機能
- 承認後の自動グループ追加
- 否認理由の入力・通知機能

**画面構成**:
- 参加申請一覧画面
- 申請詳細画面（ユーザー情報、申請理由等）
- 承認/否認アクションボタン

**データモデル**:
```json
{
  "channel_id": "channel_001",
  "user_id": "Uxxxxx...",
  "status": "pending|approved|rejected",
  "requested_at": "2025-01-18T10:00:00",
  "processed_at": "2025-01-18T11:00:00",
  "processed_by": "admin_user_id",
  "rejection_reason": "理由（否認の場合）"
}
```

---

### 2. 新規チャンネル作成承認機能

**機能名**: AI収集情報からの新規チャンネル作成承認

**目的**: GitHub WorkflowでAIが収集した新しい情報発信サイトから、LINEチャンネルを作成するか見送るかを判断

**実装内容**:
- GitHub WorkflowでAIが新しい情報発信サイトを収集
- 収集されたサイト情報を管理画面に表示
- 管理者がサイト情報を確認
- LINEチャンネル作成の承認/見送りを選択
- 承認時にLINE Developers APIでチャンネルを自動作成

**画面構成**:
- 新規サイト候補一覧画面
- サイト詳細情報画面（URL、配信方式、カテゴリ、サマリー等）
- 承認/見送りアクションボタン
- 承認後のチャンネル設定画面（カテゴリ、配信頻度等）

**データモデル**:
```json
{
  "site_candidate_id": "candidate_001",
  "url": "https://example.com",
  "collector_type": "email|rss|scraper",
  "category": "AI",
  "discovered_at": "2025-01-18T10:00:00",
  "ai_summary": "AI生成のサイト概要",
  "status": "pending|approved|rejected",
  "channel_id": "channel_xxx" // 承認後に生成
}
```

**GitHub Workflow連携**:
- サイト収集ワークフローが候補データをデータストレージに保存
- 管理画面が定期的に候補データを取得
- 承認時にチャンネル作成APIを呼び出し

---

### 3. チャンネル生成・配信ログ管理機能

**機能名**: チャンネルの生成日時と配信ログの管理

**目的**: 生成されたLINEチャンネルの情報と配信履歴を一元管理

**実装内容**:
- チャンネル一覧表示（生成日時、配信状況、統計情報）
- 各チャンネルの詳細情報表示
- 配信ログの確認（配信日時、配信数、エラー等）
- チャンネルの有効化/無効化
- 配信統計の表示（日別、週別、月別）

**画面構成**:
- チャンネル一覧画面（テーブル形式）
- チャンネル詳細画面
- 配信ログ一覧画面
- 統計ダッシュボード

**データモデル**:
```json
{
  "channel_id": "channel_001",
  "site_id": "ai_weekly",
  "channel_name": "AI Weekly 情報配信",
  "created_at": "2025-01-15T10:00:00",
  "status": "active|inactive|paused",
  "total_deliveries": 150,
  "last_delivered_at": "2025-01-18T09:00:00",
  "subscriber_count": 45
}
```

**配信ログデータモデル**:
```json
{
  "log_id": "log_001",
  "channel_id": "channel_001",
  "delivered_at": "2025-01-18T09:00:00",
  "items_count": 5,
  "success_count": 45,
  "failure_count": 0,
  "error_details": []
}
```

---

### 4. キーワード（カテゴリ）管理機能

**機能名**: AI調査対象のキーワード管理

**目的**: GitHub WorkflowでAIに調査させるサイトや情報源を絞るためのキーワードを管理

**実装内容**:
- キーワード（カテゴリ）の追加・編集・削除
- キーワードごとの優先度設定
- キーワードごとの調査頻度設定
- キーワードごとの収集結果統計
- 除外キーワード（ブラックリスト）の管理

**画面構成**:
- キーワード一覧画面
- キーワード追加・編集画面
- キーワード統計画面

**データモデル**:
```json
{
  "keyword_id": "keyword_001",
  "keyword": "AI",
  "category": "AI",
  "priority": "high|medium|low",
  "search_frequency_hours": 24,
  "enabled": true,
  "created_at": "2025-01-15T10:00:00",
  "last_searched_at": "2025-01-18T09:00:00",
  "total_discovered_sites": 15
}
```

**GitHub Workflow連携**:
- キーワード管理APIからキーワードリストを取得
- 各キーワードでAI検索を実行
- 検索結果をサイト候補として保存
- 最終検索日時を更新

**現行システムとの連携**:
- `tools/add_site.py:107-108`の`--category`引数で使用されている値
- 管理画面でカテゴリを管理できるように拡張
- カテゴリとキーワードを関連付け

---

## 🔧 技術スタック（提案）

### フロントエンド
- **フレームワーク**: React / Vue.js / Next.js
- **UIライブラリ**: Material-UI / Tailwind CSS
- **状態管理**: Redux / Zustand / React Query

### バックエンド
- **API**: REST API / GraphQL
- **フレームワーク**: FastAPI / Flask / Django REST Framework
- **認証**: JWT / OAuth 2.0
- **データベース**: PostgreSQL / MySQL / SQLite（開発環境）

### インフラ
- **ホスティング**: Render.com / Railway.app / Vercel（フロントエンド）
- **データベース**: Supabase / PostgreSQL on Render
- **認証**: Supabase Auth / Auth0

---

## 📋 実装フェーズ（将来計画）

### Phase 1: 基盤構築（2-3週間）
- 管理画面の基本構造
- 認証機能
- データベース設計・実装
- バックエンドAPI基本構造

### Phase 2: ユーザー管理機能（1-2週間）
- 参加申請機能
- 承認/否認機能
- ユーザー一覧・詳細画面

### Phase 3: キーワード管理機能（1週間）
- キーワードCRUD機能
- GitHub Workflow連携
- 統計表示機能

### Phase 4: チャンネル作成承認機能（2-3週間）
- サイト候補表示機能
- 承認/見送り機能
- LINE Developers API連携

### Phase 5: チャンネル管理・配信ログ機能（2週間）
- チャンネル一覧・詳細画面
- 配信ログ表示機能
- 統計ダッシュボード

### Phase 6: 統合・最適化（1-2週間）
- UI/UX改善
- パフォーマンス最適化
- セキュリティ強化
- テスト・デバッグ

---

## 🔗 現行システムとの連携

### 1. GitHub Workflow連携

**収集ワークフロー**:
- キーワード管理APIからキーワードリストを取得
- AI検索を実行してサイト候補を収集
- サイト候補をデータストレージに保存

**配信ワークフロー**:
- 各チャンネルの設定を取得
- 情報収集・配信を実行
- 配信ログをデータストレージに保存

### 2. LINE Developers API連携

**チャンネル作成**:
- 承認時にLINE Developers APIでチャンネルを作成
- チャンネル情報をデータベースに保存

**配信管理**:
- 各チャンネルのChannel Access Tokenを管理
- 配信時に適切なTokenを使用

### 3. データストレージ連携

**現行システム**:
- `data/sites/`でのサイト設定管理
- JSONファイルでのデータ永続化

**移行計画**:
- データベースへの移行を検討
- 既存データの移行スクリプト作成
- 両方の形式に対応する移行期間を設ける

---

## 📝 注意事項

- LINE Developers APIの利用制限に注意
- チャンネル作成の承認プロセスは慎重に設計
- ユーザーデータのプライバシー保護
- セキュリティ対策（認証、認可、入力検証）
- スケーラビリティを考慮した設計

---

## 🎯 次のアクション

1. **短期**（フェーズ2完了後）: 管理画面のプロトタイプ作成
2. **中期**（3-6ヶ月）: Phase 1-3の実装
3. **長期**（6-12ヶ月）: Phase 4-6の実装、本番運用開始

---

**最終更新**: 2025-01-18

