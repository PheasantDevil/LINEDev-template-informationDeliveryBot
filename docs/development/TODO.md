# 残りのタスク一覧

## 📋 実装状況

### ✅ 完了済み

#### Phase 1: 基盤構築

- [x] LINE Bot 基本機能（Webhook サーバー、ユーザー登録、購読管理）
- [x] 情報収集インターフェース（`collectors/base.py`）
- [x] 差分検知システム（`diff_detector.py`）
- [x] データ永続化システム（`storage.py`）
- [x] サイト管理機能（個別ファイル管理、`sites.json`自動集約）
- [x] 初期サイトデータ（サンプル）
- [x] テストガイド作成
- [x] 環境変数設定（`.env`、`.env.example`）

#### 情報収集実装

- [x] **メール受信・要約方式**（`src/collectors/email_collector.py`）⭐
  - [x] `BaseInformationCollector`を継承した`EmailCollector`クラス
  - [x] IMAP でのメール受信機能
  - [x] メール ID ベースの重複排除
  - [x] メール本文からの情報抽出（リンク、タイトル）
  - [x] AI 要約機能（Gemini 1.5 Flash）
  - [x] メールアカウント管理機能

#### 情報収集・配信実行

- [x] **情報収集・配信実行スクリプト**（`src/collect_and_deliver.py`）
  - [x] 有効なサイトを読み込み
  - [x] 各サイトの収集タイミングをチェック
  - [x] 情報収集の実行
  - [x] 差分検知で新着情報を抽出
  - [x] 新着情報を LINE で配信
  - [x] ログ出力

---

## 🔴 優先度: 高（Phase 1 完了に必要）

### 1. 追加の情報収集方式（補完的）

#### 1.1 サイト更新検知方式（`src/collectors/change_detector.py`）

- [ ] `BaseInformationCollector`を継承した`ChangeDetectorCollector`クラスを実装
- [ ] ページハッシュ値ベースの変更検知
- [ ] 変更検知後の詳細取得
- [ ] エラーハンドリング

#### 1.2 RSS リーダー実装（`src/collectors/rss_reader.py`）※ 補完的

- [ ] `BaseInformationCollector`を継承した`RSSReaderCollector`クラスを実装
- [ ] RSS/Atom フィードのパース
- [ ] 複数のフィード形式に対応
- [ ] エラーハンドリング

#### 1.3 スクレイパー実装（`src/collectors/scraper.py`）※ 補完的

- [ ] `BaseInformationCollector`を継承した`ScraperCollector`クラスを実装
- [ ] BeautifulSoup を使用した HTML パース
- [ ] サイト設定に基づいた柔軟なスクレイピング
- [ ] エラーハンドリングとリトライ機能

---

## 🟡 優先度: 中（Phase 2）

### 2. 自動実行システム

#### 2.1 GitHub Actions ワークフロー（`.github/workflows/collect-and-deliver.yml`）

- [x] 30 分間隔での自動実行設定
- [x] 手動実行も可能にする（`workflow_dispatch`）
- [x] 環境変数の設定（GitHub Secrets から取得）
- [x] エラーハンドリングと通知（将来の通知拡張に対応）

### 3. サイト管理ツール

#### 3.1 サイト追加ツール（`tools/add_site.py`）

- [x] コマンドライン引数のパース
- [x] email/rss/scraper 方式に対応
- [x] 既存サイト ID の上書き確認機能
- [x] `data/sites/`への自動追加
- [ ] URL から RSS フィードの自動検出（将来実装）
- [ ] スクレイピング設定の推奨値提示（将来実装）

#### 3.2 サイト設定管理（`src/collectors/site_config.py`）

- [ ] サイト設定の読み込み・保存（既に`Storage`で実装済み）
- [ ] 設定のバリデーション
- [ ] 設定の更新機能（既に`Storage.save_site()`で実装済み）

### 4. 実際のサイトデータ

#### 4.1 初期サイトの選定と追加

- [x] サイト追加ツールの実装完了
- [x] サイト追加ガイドの作成（`docs/site-management/SITE_ADDITION_GUIDE.md`）
- [ ] AI カテゴリ: 2-3 サイトを選定（ユーザーが実施）
- [ ] ドローンカテゴリ: 1-2 サイトを選定（ユーザーが実施）
- [ ] `data/sites/`に実際のサイト情報を追加（ユーザーが実施）
- [ ] 各サイトの収集設定を最適化（ユーザーが実施）

---

## 🟢 優先度: 低（Phase 3 以降）

### 5. 配信機能強化

#### 5.1 カテゴリ別グループ管理

- [ ] カテゴリごとの LINE グループ管理機能
- [ ] グループへのユーザー自動追加機能
- [ ] `data/category_groups.json`の管理

#### 5.2 情報検索機能

- [ ] LINE Bot での情報検索コマンド
- [ ] カテゴリ・キーワードでの検索
- [ ] 検索結果の表示

### 6. テストとデプロイ

#### 6.1 実際の LINE Bot との連携テスト

- [ ] ローカル環境でのテスト（ngrok 使用）
- [ ] 各コマンドの動作確認
- [ ] 情報収集・配信の動作確認
- [ ] エラーハンドリングの確認

#### 6.2 Webhook サーバーのデプロイ

- [ ] Render.com（または他のホスティング）でのデプロイ
- [ ] 環境変数の設定
- [ ] Webhook URL の設定
- [ ] 動作確認

### 7. 高度な機能（Phase 4）

#### 7.1 サービス紹介サイト

- [ ] GitHub Pages の設定
- [ ] サイト一覧ページの作成
- [ ] 各サイトの紹介ページ作成

#### 7.2 統計・レポート機能

- [ ] 収集統計の表示
- [ ] 配信統計の表示
- [ ] ユーザー統計の表示

---

## 📝 実装の優先順位

### 即座に実装すべき（Phase 1 完了）

1. ✅ **メール受信・要約方式**（`email_collector.py`） - **完了**
2. ✅ **情報収集・配信実行スクリプト**（`collect_and_deliver.py`） - **完了**

### 次に実装すべき（Phase 2）

3. ✅ **GitHub Actions ワークフロー** - 自動実行システム - **完了**
4. ✅ **サイト追加ツール**（`add_site.py`） - サイト管理の効率化 - **完了**
5. ✅ **実際のサイトデータへの置き換え** - サイト追加ガイド作成完了（ユーザーが実施）

### その後（Phase 3 以降）

6. **連携テストの実施** - 動作確認
7. **Webhook サーバーのデプロイ** - 本番環境構築
8. **カテゴリ別グループ管理** - 機能強化
9. **情報検索機能** - 機能強化
10. **追加の情報収集方式**（RSS、スクレイパー、変更検知） - 補完機能

---

## 🎯 次のアクション

**最優先で実装すべき項目：**

1. ✅ **GitHub Actions ワークフロー** - 自動実行システムの構築 - **完了**
2. ✅ **サイト追加ツール** - サイト管理の効率化 - **完了**
3. ✅ **実際のサイトデータへの置き換え** - サイト追加ガイド作成完了

**次のステップ：**

- ユーザーが実際のサイトを選定し、`tools/add_site.py`または手動で追加
- GitHub Secrets に環境変数を設定
- GitHub Actions ワークフローが正常に動作することを確認

これらが完了すれば、基本的な情報収集・配信機能が自動化され、本番運用を開始できます。

---

**最終更新**: 2025-01-15

## 📝 実装方針の変更履歴

### 2025-01-12: 情報収集方法の再検討

- スクレイパー・RSS 方式の問題点を踏まえ、メール方式を優先実装に変更
- 詳細は `docs/20260112/004-prompt.md` を参照

### 2025-01-15: 実装状況の整理

- メール受信・要約方式の実装完了を確認
- 情報収集・配信実行スクリプトの実装完了を確認
- サイト管理機能（個別ファイル管理、sites.json 自動集約）の実装完了を確認

### 2025-01-15: Phase 2 実装完了

- GitHub Actions ワークフローの実装完了
- サイト追加ツール（`tools/add_site.py`）の実装完了
- サイト追加ガイド（`docs/site-management/SITE_ADDITION_GUIDE.md`）の作成完了
